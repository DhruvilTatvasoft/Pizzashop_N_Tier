@model TableAndSectionViewModel
<div class="d-flex">
  <h3 class="p-3 c-text">Tables</h3>
  <div class="d-flex justify-content-end w-100 m-3 ">

    <div class="me-3">
      <input type="email" class="form-control h-100 " id="searchedTable" placeholder="Search">
      <input type="hidden" class="form-control h-100 " id="HiddenSectionId" asp-for="sectionId">
    </div>
    <button class="btn btn-outline-secondary me-2" id="deleteMultipleTables"
      onclick="OpenDeleteMultipleModal(@Model.sectionId)"><img src="~/images/trash-fill.svg" style="cursor: pointer;"
        alt=""></button>
    <button class="btn btn-primary me-3 add-item-modifier" data-bs-toggle="modal" data-bs-target="#addTableModal"
      type="button">+ New Table</button>
    <input type="text" hidden>
  </div>
</div>
<div id="loadEditModel"></div>
<div class="tbl m-3 table-responsive">
  <table class="table">
  </table>
  <div class="bg-white w-100 d-flex justify-content-end align-items-center pe-2">
    <div class="d-flex justify-content-center align-items-center">
      <label for="" class="me-2">items per page:</label>
      <div class="dropdown mt-2 me-2">
        <select class="form-select form-select-lg mb-3" aria-label=".form-select-lg example">
          <option value="1" selected>1</option>
          <option value="2">2</option>
          <option value="3">3</option>
          <option value="3">4</option>
          <option value="3">5</option>
          <option value="3">6</option>
        </select>
      </div>
    </div>
    <label for="" class="me-2">Showing 1-5 of 13</label>
    <div class="d-flex mt-1">
      <button type="button" class="btn btn-outline-dark btn2" style="
                                           padding: 6px;
                                       "><img src="" alt=""><img src="~/images/left-chevron-svgrepo-com.svg"
          style="width:25px" alt=""></button>
      <button type="button" class="btn btn-outline-dark btn2 mb-2" style="
                                           padding: 5.8px;
                                       "><img src="~/images/left-chevron-svgrepo-com.svg"
          style="width:25px;rotate: 180deg;" alt=""></button>
    </div>
  </div>
  <!-- Add Table Modal -->

  <form id="addNewTableForm">
    <div class="modal fade" id="addTableModal" tabindex="-1" style="--bs-modal-width: 367px;"
      aria-labelledby="addTableModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
          <div class="modal-header" style="border: none;">
            <h5 class="modal-title" id="addTableModalLabel">Add Table</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <div class="row">
              <div class="mb-3 col-md-6">
                <input type="text" class="form-control" asp-for="@Model.table.Tablename"
                  style="padding: 6%;padding-top: 8%;" id="tableName" placeholder="Name*">
              </div>
              <div class="mb-3 col-md-6">
                <label for="" class="form-label"
                  style="position: absolute;left: 56%;top: 12%;font-size: 54%;">section*</label>
                <select class="form-select" style="padding: 6%;padding-top: 8%;" asp-for="@Model.table.Sectionid"
                  id="tableSection">
                  @foreach (var sec in @Model.sections)
                  {
                    <option value="@sec.Sectionid">@sec.Sectionname</option>
                  }
                </select>
              </div>
            </div>
            <div class="row">
              <label for="" class="form-label"
                style="position: absolute;left: 3%;top: 52%;font-size: 54%;">capacity*</label>
              <div class="col-md-6 mb-3">
                <input type="number" class="form-control" style="padding: 6%;padding-top: 8%;" id="tableCapacity"
                  asp-for="@Model.table.Capacity" placeholder="capacity" value="0" min="0">
              </div>
              <div class="col-md-6 mb-3">
                <label for="" class="form-label"
                  style="position: absolute;left: 56%;top: 52%;font-size: 54%;">Status*</label>
                <select class="form-select" style="padding: 6%;padding-top: 8%;" placeholder="status" id="tableStatus">
                  <option value="true">Available</option>
                  <option value="false">Occupied</option>
                </select>
              </div>
            </div>
          </div>
          <div class="modal-footer">
            <button type="submit" class="btn btn-primary" data-bs-dismiss="modal">Save</button>
            <button type="button" class="btn btn-outline-primary" data-bs-dismiss="modal">Cancel</button>
          </div>
        </div>
      </div>
    </div>
  </form>


  


  <script>
    $("document").ready(function () {
      console.log("loaded");
      loadTableData(1);
    })

    $("#addNewTableForm").on("submit", function (e) {
      e.preventDefault();
      var data = new FormData(this);
      data.append("table.Status", document.querySelector("#tableStatus").value);
      for (var pair of data.entries()) {
        console.log(pair[0] + ', ' + pair[1]);
      }
      $.ajax({
        url: '@Url.Action("AddNewTable", "TableAndsection")',
        type: 'POST',
        data: data,
        processData: false,
        contentType: false,
        success: function (data) {
          console.log(data);
          $("#addTableModal").modal('hide');
          loadTableData(data.table.sectionid);
        }
      });
    })

    function deleteMultipleTables() {
      var selectedTables = [...document.querySelectorAll(".checkedTable:checked")].map(x => parseInt(x.value, 10));
      var sectionid = document.querySelector("#sectionIdFortables").value;
      selectedTables.forEach((t) => {
        console.log(t);
      })
      $.ajax({
        url: '@Url.Action("deleteTable", "TableAndSection")',
        type: 'POST',
        data: { selectedTables: selectedTables, sectionid: sectionid },
        success: function (data) {
          console.log(data);
          loadTableData(data.sectionid);
          $("#deleteForTableSAndSectionModel").modal('hide');
        }
      });
    }
    function OpenDeleteMultipleModal(sectionId) {
      $.ajax({
        url: '@Url.Action("deleteModalGet", "TableAndSection")',
        type: "GET",
        data: { sectionId: sectionId },
        success: function (data) {
          $("#loadDeleteModal").html(data);
          $("#deleteForTableSAndSectionModel").modal('show');
          document.querySelector("#deleteMultipletable").style.display = "block";
          document.querySelector("#deleteSection").style.display = "none";
          document.querySelector("#deleteSingleTable").style.display = "none";
          $("#deleteText").text("Are you sure you want to delete these Tables?");
          @* $("#sectionIdFortables").val(sectionId); *@
        }
      });
    }

    function openSingleDeleteModal(tableid) {
      var sectionId = $("#sectionIdFortables").val();
      $.ajax({
        url: '@Url.Action("deleteModalGet", "TableAndSection")',
        type: "GET",
        data: { sectionId: sectionId },
        success: function (data) {
          $("#loadDeleteModal").html(data);
          $("#deleteForTableSAndSectionModel").modal('show');
          document.querySelector("#deleteMultipletable").style.display = "none";
          document.querySelector("#deleteSection").style.display = "none";
          document.querySelector("#deleteSingleTable").style.display = "block";
          $("#deleteText").text("Are you sure you want to delete these Table?");
          $("#deleteId").val(tableid);
        }
      });
    }

    function deletesingletable(){
      var sectionid = document.querySelector("#sectionIdFortables").value;
      $.ajax({
        url: '@Url.Action("deleteTable", "TableAndSection")',
        type: 'POST',
        data: {tableid : $("#deleteId").val(),sectionid:sectionid},
        success: function(data){
           loadTableData(data.sectionid);
           $("#deleteForTableSAndSectionModel").modal('hide');
        }
      });
    }



       function openEditModal(tableid){
      $.ajax({
         url:'@Url.Action("updatetableGet","TableAndSection")',
         type:'GET',
         data:{tableid:tableid},
         success:function(data){
             $("#loadEditModel").html(data);
             $("#sectionIdFortables").val(sectionId);
             $("#EditTableModal").modal('show');
         }
      });
   }


   
  </script>
</div>
